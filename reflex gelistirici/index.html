<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 Reflex Testi</title>
    <style>
        /* CSS Ba≈ülangƒ±cƒ± */
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #000000;
            color: #ffffff;
            font-family: 'Arial Black', sans-serif;
            user-select: none;
            cursor: pointer;
            transition: background-color 0.5s;
        }

        /* Yeni Buton ve Konumlandƒ±rma */
        #history-button {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 15px;
            background-color: #ff0000;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            z-index: 100;
            transition: background-color 0.2s;
        }

        #history-button:hover {
            background-color: #670000;
        }

        /* Ge√ßmi≈ü G√∂r√ºnt√ºleme Modalƒ± */
        #history-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        #history-content {
            background-color: #000000;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 400px;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        #history-content h3 {
            margin-top: 0;
            border-bottom: 2px solid #000000;
            padding-bottom: 10px;
            color: #ff0000;
        }

        #history-list {
            list-style: none;
            padding: 0;
        }

        #history-list li {
            padding: 8px 0;
            border-bottom: 1px solid #000000;
            display: flex;
            justify-content: space-between;
            font-family: monospace;
            font-size: 1.1em;
        }

        #history-list li:last-child {
            border-bottom: none;
        }

        .best-time {
            color: rgb(255, 0, 0);
            font-weight: bold;
        }

        .close-button {
            float: right;
            font-size: 1.5em;
            font-weight: bold;
            color: #ffffff;
            cursor: pointer;
        }
        .close-button:hover {
            color: white;
        }
        /* Diƒüer elementlerin stilleri aynƒ± kalƒ±r */
        #lights-container {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .light {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background-color: #333;
            border: 4px solid #ff0000;
            transition: background-color 0.1s, box-shadow 0.1s;
        }

        .light.on {
            background-color: #cc0000;
            box-shadow: 0 0 15px #ff4444, 0 0 30px #ff0000;
        }

        #status-display {
            font-size: 1.8em;
            font-weight: 900;
            text-align: center;
            min-height: 50px;
            color: #ccc;
        }

        #reaction-time {
            font-size: 3.5em;
            color: #ff0000;
            font-weight: 900;
            margin-top: 20px;
            text-shadow: 0 0 5px #ff0000;
        }

        .error {
            color: #ff0000 !important;
        }
        /* CSS Biti≈üi */
    </style>
</head>
<body>

    <button id="history-button">Zaman Ge√ßmi≈üimiz</button>

    <div id="lights-container">
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
    </div>

    <div id="status-display">Yarƒ±≈üa ba≈ülamak i√ßin herhangi bir yere **tƒ±klayƒ±n** (veya dokunun).</div>

    <div id="reaction-time">0.000 s</div>

    <div id="history-modal">
        <div id="history-content">
            <span class="close-button" onclick="document.getElementById('history-modal').style.display = 'none';">&times;</span>
            <h3>üèÅ Reaksiyon S√ºresi Ge√ßmi≈üi</h3>
            <ul id="history-list">
                </ul>
        </div>
    </div>
    
    <audio id="light-sound" src="light.mp3" preload="auto"></audio>
    <audio id="go-sound" src="go_sound.mp3" preload="auto"></audio>

    <script>
        // JavaScript Ba≈ülangƒ±cƒ±
        const lights = document.querySelectorAll('.light');
        const statusDisplay = document.getElementById('status-display');
        const reactionTimeDisplay = document.getElementById('reaction-time');
        const totalLights = lights.length;
        const historyButton = document.getElementById('history-button');
        const historyModal = document.getElementById('history-modal');
        const historyList = document.getElementById('history-list');

        // YENƒ∞: Ses elementlerini se√ßme
        const lightSound = document.getElementById('light-sound');
        const goSound = document.getElementById('go-sound');


        let state = 'ready';
        let startTime = 0;
        let lightsOutTimeout = null;
        let reactionHistory = [];

        // --- Ge√ßmi≈ü Fonksiyonlarƒ± ---

        function loadHistory() {
            const historyJSON = localStorage.getItem('f1ReactionHistory');
            if (historyJSON) {
                reactionHistory = JSON.parse(historyJSON);
                // En iyi s√ºrenin en √ºstte olmasƒ±nƒ± saƒülamak i√ßin k√º√ß√ºkten b√ºy√ºƒüe sƒ±rala
                reactionHistory.sort((a, b) => a - b);
            }
        }

        function saveReaction(time) {
            // Sadece ba≈üarƒ±lƒ± reaksiyonlarƒ± (0.000 s'den b√ºy√ºk) kaydet
            if (time > 0) {
                reactionHistory.push(time);
                // En iyi s√ºrenin en √ºstte olmasƒ± i√ßin tekrar sƒ±rala
                reactionHistory.sort((a, b) => a - b);
                // Sadece son 120 reaksiyonu tutmak isteyebiliriz
                if (reactionHistory.length > 120) {
                    reactionHistory = reactionHistory.slice(0, 120);
                }
                localStorage.setItem('f1ReactionHistory', JSON.stringify(reactionHistory));
            }
        }

        function displayHistory() {
            historyList.innerHTML = ''; // Listeyi temizle
            
            if (reactionHistory.length === 0) {
                historyList.innerHTML = '<li>Hen√ºz kaydedilmi≈ü bir reaksiyon s√ºreniz yok.</li>';
            } else {
                reactionHistory.forEach((time, index) => {
                    const listItem = document.createElement('li');
                    const timeString = time.toFixed(3) + ' s';
                    
                    // En iyi reaksiyon s√ºresini i≈üaretle
                    if (index === 0) {
                        listItem.innerHTML = `<span>ü•á EN ƒ∞Yƒ∞:</span> <span class="best-time">${timeString}</span>`;
                    } else {
                        listItem.innerHTML = `<span>#${index + 1}:</span> <span>${timeString}</span>`;
                    }
                    historyList.appendChild(listItem);
                });
            }
            historyModal.style.display = 'flex'; // Modalƒ± g√∂ster
        }

        // --- Mevcut Oyun Fonksiyonlarƒ± G√ºncellemeleri ---
        
        document.body.addEventListener('click', handleClick);
        document.body.addEventListener('touchstart', handleClick);
        historyButton.addEventListener('click', (e) => {
            e.stopPropagation(); // Tƒ±klamanƒ±n body'ye yayƒ±lmasƒ±nƒ± engeller
            displayHistory();
        });

        // Modal dƒ±≈üƒ±na tƒ±klayƒ±nca kapatma
        historyModal.addEventListener('click', (e) => {
            if (e.target === historyModal) {
                historyModal.style.display = 'none';
            }
        });


        function resetGame() {
            lights.forEach(light => light.classList.remove('on'));
            statusDisplay.textContent = 'Yarƒ±≈üa ba≈ülamak i√ßin herhangi bir yere **tƒ±klayƒ±n** (veya dokunun).';
            statusDisplay.classList.remove('error');
            reactionTimeDisplay.textContent = '0.000 s';
            state = 'ready';
            clearTimeout(lightsOutTimeout);
        }

        function handleClick(event) {
            if (event.type === 'touchstart') {
                event.preventDefault();
            }
            // Eƒüer ge√ßmi≈ü modalƒ± a√ßƒ±ksa, oyuna deƒüil moda tƒ±klandƒ± demektir.
            if (historyModal.style.display === 'flex') {
                return; 
            }

            if (state === 'ready') {
                startSequence();
            } else if (state === 'waiting') {
                // Hatalƒ± Ba≈ülangƒ±√ß (False Start)
                clearTimeout(lightsOutTimeout);
                
                // YENƒ∞: Hatalƒ± ba≈ülangƒ±√ßta ƒ±≈üƒ±k sesini durdur
                lightSound.pause();
                lightSound.currentTime = 0;

                lights.forEach(light => light.classList.add('on'));
                statusDisplay.textContent = 'HATA! √áok erken ba≈üladƒ±nƒ±z. Tekrar denemek i√ßin tƒ±klayƒ±n.';
                statusDisplay.classList.add('error');
                reactionTimeDisplay.textContent = '√áok Erken';
                state = 'complete';
            } else if (state === 'running') {
                // I≈üƒ±klar s√∂nd√ºƒü√ºnde tƒ±klandƒ± (Reaksiyon zamanƒ± √∂l√ß√ºl√ºr)
                const stopTime = performance.now();
                const reactionTime = (stopTime - startTime) / 1000;
                
                // YENƒ∞: Ba≈üarƒ±lƒ± s√ºreyi kaydet
                saveReaction(reactionTime); 

                statusDisplay.textContent = 'REAKSƒ∞YON S√úRENƒ∞Z:';
                statusDisplay.classList.remove('error');
                reactionTimeDisplay.textContent = reactionTime.toFixed(3) + ' s';
                state = 'complete';
            } else if (state === 'complete') {
                resetGame();
            }
        }

        function startSequence() {
            state = 'waiting';
            statusDisplay.textContent = 'BEKLEYƒ∞N...';
            reactionTimeDisplay.textContent = '0.000 s';
            lights.forEach(light => light.classList.remove('on'));

            let lightIndex = 0;
            const lightInterval = 900; 

            function turnOnNextLight() {
                if (lightIndex < totalLights) {
                    lights[lightIndex].classList.add('on');
                    
                    // YENƒ∞: I≈üƒ±k yanarken ses √ßal
                    lightSound.currentTime = 0; // Sesi ba≈ütan ba≈ülat
                    // Sesin √ßalmasƒ±nƒ± deniyoruz, hata olursa konsola yazar (√∂rn. tarayƒ±cƒ± kƒ±sƒ±tlamalarƒ±)
                    lightSound.play().catch(e => console.log("Ses √ßalma hatasƒ±:", e)); 
                    
                    lightIndex++;
                    setTimeout(turnOnNextLight, lightInterval);
                } else {
                    const randomDelay = Math.random() * 2500 + 1000;
                    lightsOutTimeout = setTimeout(lightsOut, randomDelay);
                }
            }

            turnOnNextLight();
        }

        function lightsOut() {
            lights.forEach(light => light.classList.remove('on'));
            statusDisplay.textContent = 'Gƒ∞T! üö¶';
            statusDisplay.classList.remove('error');
            startTime = performance.now();
            state = 'running';
            
            // YENƒ∞: I≈üƒ±klar s√∂nd√ºƒü√ºnde GO sesini √ßal
            goSound.currentTime = 0; // Sesi ba≈ütan ba≈ülat
            goSound.play().catch(e => console.log("GO sesi √ßalma hatasƒ±:", e));
        }

        // Ba≈ülangƒ±√ßta ge√ßmi≈üi y√ºkle
        loadHistory();
        resetGame();
        // JavaScript Biti≈üi
    </script>
</body>
</html>
